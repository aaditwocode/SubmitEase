generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                   Int          @id @default(autoincrement())
  email                String       @unique
  password             String
  firstname            String
  lastname             String
  role                 String[]
  expertise            String[]
  organisation         String
  country              String
  Paper                Paper[]
  hostedConferences    Conference[] @relation("HostToConference")
  reviewedConferences  Conference[] @relation("ReviewerToConference")
  Reviews              Reviews[]
  ConfReviewInvitation Conference[] @relation("InvitedReviewerToConference")
  ChairedTracks        Tracks[]     @relation("TrackChairs")
  PublicationChairs    Conference[] @relation("PublicationChairs")
  RegistrationChairs   Conference[] @relation("RegistrationChairs")

  JournalRole    String[]
  hostedJournals Journal[]        @relation("HostToJournal")
  JournalPapers  JournalPapers[]  @relation("JournalAuthors")
  JournalReviews JournalReviews[]
}

model Conference {
  id                 Int      @id @default(autoincrement())
  name               String
  location           String
  startsAt           DateTime
  endAt              DateTime
  deadline           DateTime
  link               String
  status             String
  Partners           String[]
  hostID             Int
  host               User?    @relation("HostToConference", fields: [hostID], references: [id])
  Paper              Paper[]
  Reviewers          User[]   @relation("ReviewerToConference")
  InvitedReviewers   User[]   @relation("InvitedReviewerToConference")
  Tracks             Tracks[]
  PublicationChairs  User[]   @relation("PublicationChairs")
  RegistrationChairs User[]   @relation("RegistrationChairs")
}

model Paper {
  id                    String      @id
  Title                 String
  ConferenceId          Int
  Conference            Conference? @relation(fields: [ConferenceId], references: [id])
  Authors               User[]
  URL                   String
  Abstract              String
  Keywords              String[]
  isFinal               Boolean     @default(false)
  TrackId               Int?
  Tracks                Tracks?     @relation(fields: [TrackId], references: [id])
  Status                String
  submittedAt           DateTime
  AuthorOrder           Int[]
  Reviews               Reviews[]
  ReviewerOrder         Int[]
  FinalPaperURL         String?
  CopyrightURL          String?
  RegistrationURL       String?
  Completed             Boolean     @default(false)
  CompletedPublication  Boolean     @default(false)
  CompletedRegistration Boolean     @default(false)
}

model Reviews {
  id                Int       @id @default(autoincrement())
  PaperId           String
  Paper             Paper?    @relation(fields: [PaperId], references: [id])
  ReviewerId        Int
  User              User?     @relation(fields: [ReviewerId], references: [id])
  Comment           String
  Recommendation    String
  Status            String?
  isBlind           Boolean?
  submittedAt       DateTime?
  assignedAt        DateTime?
  scoreOriginality  Int?
  scoreClarity      Int?
  scoreSoundness    Int?
  scoreSignificance Int?
  scoreRelevance    Int?
  avgScore          Float     @default(0)

  @@unique([PaperId, ReviewerId])
}

model Tracks {
  id           Int         @id @default(autoincrement())
  Name         String
  ConferenceId Int
  Conference   Conference? @relation(fields: [ConferenceId], references: [id])
  Chairs       User[]      @relation("TrackChairs")
  Paper        Paper[]
}

model JournalPapers {
  id          String           @id
  Title       String
  Authors     User[]           @relation("JournalAuthors")
  URL         String
  Abstract    String
  Keywords    String[]
  Status      String
  submittedAt DateTime
  AuthorOrder Int[]
  JournalId   Int
  Journal     Journal          @relation(fields: [JournalId], references: [id])
  Reviews     JournalReviews[]
}

model JournalReviews {
  id                Int            @id @default(autoincrement())
  PaperId           String
  Paper             JournalPapers? @relation(fields: [PaperId], references: [id])
  ReviewerId        Int
  User              User?          @relation(fields: [ReviewerId], references: [id])
  Comment           String
  Recommendation    String
  Status            String?
  isBlind           Boolean?
  submittedAt       DateTime?
  assignedAt        DateTime?
  scoreOriginality  Int?
  scoreClarity      Int?
  scoreSoundness    Int?
  scoreSignificance Int?
  scoreRelevance    Int?
  avgScore          Float          @default(0)

  @@unique([PaperId, ReviewerId])
}

model Journal {
  id          Int             @id @default(autoincrement())
  name        String
  link        String
  status      String
  Publication String
  hostID      Int
  host        User?           @relation("HostToJournal", fields: [hostID], references: [id])
  Paper       JournalPapers[]
}
